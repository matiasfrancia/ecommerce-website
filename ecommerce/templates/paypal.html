{% extends 'base.html' %}

{% block title %}Paypal{% endblock %}

{% block styles %}
    {% load static %}
    
{% endblock %}

{% block content%}
    <script
        src="https://www.paypal.com/sdk/js?client-id=ATSqojD3xuFtksX81DpxGXmks6t2BZ_1raFP4FFaYMKfb2wERDUkaKGN6BazAgfdHn3A1ziYoqC5miRz">
    </script>

    <div id="paypal-button-container"></div>

    <script>

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

        paypal.Buttons({
            createOrder: function(data, actions) {
            // This function sets up the details of the transaction, including the amount and line item details.
            return fetch('/cart/pay', {
                method: 'POST',
                headers: {
                'content-type': 'application/json',
                'X-CSRFToken': csrftoken,
                }
            }).then(function(res) {
                return res.json();
            }).then(function(data) {
                return data.id; // Use the key sent by your server's response, ex. 'id' or 'token'
            });
            },
            onApprove: function(data, actions) {
            // This function captures the funds from the transaction.
            return actions.order.capture().then(function(details) {
                // This function shows a transaction success message to your buyer.
                alert('Transaction completed by ' + details.payer.name.given_name);
            });
            }
        }).render('#paypal-button-container');
    </script>

<h1>Paypal</h1>
{% endblock %}